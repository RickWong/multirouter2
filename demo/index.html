<!doctype html>
<html>
<body>
	<div></div>
	<script src="./react.js"></script>
	<script src="./JSXTransformer.js"></script>
	<script src="./reflux.js"></script>
	<script src="../dist/multirouter.js"></script>
	<script type="text/jsx">
		/** @jsx React.DOM **/

		var Routes = {
			settings: Multirouter.createRoute("settings"),
			modal:    Multirouter.createRoute("modal")
		};

		var multirouter = Multirouter.createStore({
			root: location.origin + location.pathname,
			compatible: true,
			upgrade:    false,
			routes:     Routes
		});

		var routeChanged = function (routes) {
			console.log("Global handler: ", JSON.stringify(routes), "-->", multirouter.toString());
		};

		multirouter.listen(routeChanged);

		Routes.settings(true);
		Routes.settings(false);
		Routes.settings(null);
		Routes.settings("profile");
		Routes.modal("company");
		Routes.modal(undefined);

		multirouter.unlisten(routeChanged);

		var App = React.createClass({
			mixins:             [Reflux.ListenerMixin],
			componentWillMount: function () {
				this.listenTo(multirouter, this.onRouteChange, this.onRouteChange);

				window.foo = Multirouter.createRoute("foo")
				foo.listenTo(multirouter)
				foo()
			},
			onRouteChange:      function (routes) {
				console.log("React handler: ", JSON.stringify(routes), "-->", multirouter.toString());
			},
			render:             function () {
				return <b>Welcome to Multirouter</b>;
			}
		});

		React.renderComponent(<App />, document.body);
	</script>
</body>
</html>
